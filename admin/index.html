<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VAMSHA VRUKSHA - ADMIN</title>
 
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#E91E63">
    <link rel="apple-touch-icon" href="../icon-512.png">
    <link rel="icon" href="../icon-512.png" type="image/png">
    <style>
        /* --- CSS Variables & Reset --- */
        :root { --sidebar-width: 260px; --header-height: 60px; --primary-color: #E91E63; --text-dark: #333; --bg-light: #f4f7f6; }
        body { margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow: hidden; display: flex; height: 100vh; height: 100dvh; background: var(--bg-light); }
        * { box-sizing: border-box; }

        /* --- Sidebar (Slide Bar) --- */
        #sidebar { width: var(--sidebar-width); background: #fff; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; z-index: 1000; transition: transform 0.3s ease; flex-shrink: 0; }
        .brand { padding: 25px 20px; text-align: center; border-bottom: 1px solid #eee; }
        .brand img { width: 80px; height: auto; margin-bottom: 15px; display: block; margin-left: auto; margin-right: auto; }
        .brand h1 { margin: 0; font-size: 22px; color: var(--text-dark); letter-spacing: 1px; }
        .brand h2 { margin: 8px 0 0; font-size: 13px; color: #777; font-weight: normal; text-transform: uppercase; letter-spacing: 0.5px; }
        
        .menu { list-style: none; padding: 20px 0; margin: 0; flex: 1; overflow-y: auto; }
        .menu li a { display: block; padding: 15px 25px; color: #555; text-decoration: none; font-weight: 500; transition: all 0.2s; border-left: 4px solid transparent; }
        .menu li a:hover, .menu li a.active { background: #fff0f5; color: var(--primary-color); border-left-color: var(--primary-color); }
        
        /* --- Main Content Area --- */
        #main { flex: 1; display: flex; flex-direction: column; position: relative; width: 100%; overflow: hidden; }
        
        /* Header */
        header { height: var(--header-height); background: #fff; border-bottom: 1px solid #e0e0e0; display: flex; align-items: center; padding: 0 20px; justify-content: space-between; flex-shrink: 0; }
        .toggle-btn { font-size: 24px; cursor: pointer; display: none; margin-right: 15px; color: #555; }
        
        /* Search Bar */
        .search-wrapper { flex: 1; max-width: 500px; display: flex; align-items: center; position: relative; }
        #search-input { width: 100%; padding: 10px 20px; border: 1px solid #ddd; border-radius: 25px; outline: none; font-size: 16px; transition: border 0.3s; background: #f9f9f9; }
        #search-input:focus { border-color: var(--primary-color); background: #fff; }
        #search-suggestions { position: absolute; top: 100%; left: 0; right: 0; background: #fff; border: 1px solid #ddd; border-radius: 8px; max-height: 300px; overflow-y: auto; z-index: 2000; display: none; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-top: 5px; }
        .suggestion-item { padding: 12px 20px; cursor: pointer; border-bottom: 1px solid #f0f0f0; font-size: 14px; }
        .suggestion-item:hover { background-color: #f5f5f5; color: var(--primary-color); }

        /* Tree Container */
        #tree { flex: 1; width: 100%; height: 100%; background-color: #fff; position: relative; touch-action: none; }

        /* --- Modal Styles --- */
        #person-modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 3000; justify-content: center; align-items: center; backdrop-filter: blur(2px); }
        #person-modal-overlay.show { display: flex; }
        #person-modal { background: #fff; width: 95%; max-width: 480px; max-height: 90vh; border-radius: 12px; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 15px 35px rgba(0,0,0,0.2); animation: slideUp 0.3s ease; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .modal-header { padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; background: #fff; }
        .modal-header h3 { margin: 0; font-size: 18px; color: var(--text-dark); }
        .modal-close { background: none; border: none; font-size: 24px; cursor: pointer; color: #999; }
        
        .modal-scroll-content { overflow-y: auto; flex: 1; padding: 0; }
        .avatar-section { padding: 20px; text-align: center; background: linear-gradient(to bottom, #f9f9f9, #fff); }
        #person-modal-avatar { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 3px solid #fff; box-shadow: 0 4px 10px rgba(0,0,0,0.1); display: none; margin: 0 auto; }
        #person-modal-avatar-fallback { width: 100px; height: 100px; border-radius: 50%; background: #e0e0e0; color: #757575; font-size: 36px; display: flex; justify-content: center; align-items: center; margin: 0 auto; font-weight: bold; }
        #person-modal-id { margin-top: 10px; font-size: 12px; color: #888; font-family: monospace; }
        
        .details-table { width: 100%; border-collapse: collapse; margin-top: 0; }
        .details-table tr { border-bottom: 1px solid #f5f5f5; }
        .details-table th, .details-table td { padding: 12px 20px; font-size: 14px; }
        
        .modal-footer { padding: 15px 20px; border-top: 1px solid #eee; display: flex; justify-content: flex-end; gap: 10px; background: #f9f9f9; }
        .btn { padding: 8px 16px; border-radius: 6px; border: none; cursor: pointer; font-size: 13px; font-weight: 500; }
        .btn-primary { background: var(--primary-color); color: white; }
        .btn-outline { background: transparent; border: 1px solid #ccc; color: #555; }

        /* --- Sidebar backdrop (mobile: tap outside to close) --- */
        #sidebar-backdrop { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.35); z-index: 999; }
        #sidebar-backdrop.show { display: block; }

        /* --- Responsive Logic --- */
        @media (min-width: 769px) {
            #sidebar-backdrop.show { display: none; }
        }
        @media (max-width: 768px) {
            #sidebar { position: fixed; height: 100%; transform: translateX(-100%); box-shadow: 2px 0 10px rgba(0,0,0,0.1); }
            #sidebar.open { transform: translateX(0); }
            #sidebar-backdrop.show { display: block; }
            .toggle-btn { display: block; }
            #main { width: 100%; }
            header { padding: 0 10px; }
        }

        /* --- Dashboard Styles --- */
        #dashboard-page { display: none; flex: 1; padding: 20px; overflow-y: auto; background: #f4f7f6; animation: fadeIn 0.3s ease; }
        .dash-welcome { background: #fff; padding: 15px 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px; }
        .dash-welcome h2 { margin: 0; font-size: 18px; color: #333; }
        .dash-date { color: #888; font-size: 14px; font-weight: 500; }
        
        .namaste-card { background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); color: white; padding: 15px 20px; border-radius: 12px; text-align: center; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(30, 60, 114, 0.3); position: relative; overflow: hidden; }
        .namaste-card { background: linear-gradient(135deg, #FF9966 0%, #FF5E62 100%); color: white; padding: 15px 20px; border-radius: 12px; text-align: center; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(255, 94, 98, 0.3); position: relative; overflow: hidden; }
        .namaste-card h1 { margin: 0; font-size: 24px; letter-spacing: 1px; }
        .namaste-card p { margin: 0; opacity: 0.95; font-size: 16px; font-weight: 500; }
        .dash-message-card { display: none; background: #fff; padding: 15px 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; color: #E91E63; font-weight: 600; font-size: 15px; border-left: 5px solid #E91E63; animation: fadeIn 0.3s ease; line-height: 1.5; }
        
        .open-tree-card { background: #fff; border-radius: 16px; padding: 0; margin-bottom: 20px; cursor: pointer; transition: transform 0.2s; box-shadow: 0 4px 15px rgba(0,0,0,0.05); overflow: hidden; position: relative; height: 180px; display: flex; align-items: center; justify-content: center; border: 2px solid transparent; }
        .open-tree-card:hover { border-color: var(--primary-color); }
        .open-tree-card:active { transform: scale(0.98); }
        /* Placeholder tree illustration using CSS/SVG background */
        .open-tree-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0.2; background-image: url('../ftree.jpg'); background-repeat: no-repeat; background-position: center; background-size: cover; }
        .open-tree-content { position: relative; z-index: 2; text-align: center; }
        .open-tree-btn { background: var(--primary-color); color: white; padding: 12px 30px; border-radius: 30px; font-weight: bold; font-size: 16px; border: none; box-shadow: 0 4px 10px rgba(74, 144, 226, 0.4); pointer-events: none; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 15px; }
        .stat-card { background: #fff; padding: 20px 15px; border-radius: 12px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); cursor: pointer; transition: transform 0.2s; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 130px; }
        .stat-card:active { transform: scale(0.98); }
        .stat-icon { font-size: 28px; margin-bottom: 10px; }
        .stat-value { font-size: 22px; font-weight: bold; color: #333; margin-bottom: 5px; }
        .stat-label { font-size: 12px; color: #777; font-weight: 500; text-transform: uppercase; }

        /* Utility to hide tree */
        .hidden { display: none !important; }

        /* --- User Identity Card --- */
        .user-identity-card { background: #fff; padding: 15px 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; animation: fadeIn 0.3s ease; }
        .user-identity-content { display: flex; justify-content: space-between; align-items: center; }
        .user-identity-info { display: flex; flex-direction: column; }
        .user-identity-label { font-size: 12px; color: #888; margin-bottom: 4px; }
        .user-identity-name { font-size: 16px; font-weight: bold; color: var(--primary-color); }
        .user-change-btn { background: transparent; border: 1px solid #ccc; color: #666; padding: 6px 14px; border-radius: 20px; font-size: 12px; cursor: pointer; font-weight: 500; transition: all 0.2s; }
        .user-change-btn:hover { border-color: var(--primary-color); color: var(--primary-color); background: #f0f7ff; }

        /* --- Generic App Toast --- */
        .app-toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: rgba(50, 50, 50, 0.95); color: #fff; padding: 14px 24px; border-radius: 50px; box-shadow: 0 6px 20px rgba(0,0,0,0.25); z-index: 6000; opacity: 0; pointer-events: none; transition: opacity 0.3s ease, transform 0.3s ease; font-size: 14px; font-weight: 500; text-align: center; max-width: 90%; width: max-content; backdrop-filter: blur(4px); border: 1px solid rgba(255,255,255,0.1); }
        .app-toast.show { opacity: 1; transform: translateX(-50%) translateY(-10px); }

        /* --- Lineage Path Bar --- */
        #lineage-bar { display: none; align-items: center; gap: 8px; padding: 10px 15px; background: #f8f9fa; border-top: 1px solid #e0e0e0; overflow-x: auto; white-space: nowrap; -webkit-overflow-scrolling: touch; scrollbar-width: none; flex-shrink: 0; }
        #lineage-bar::-webkit-scrollbar { display: none; }
        .lineage-item { font-size: 13px; color: #555; cursor: pointer; padding: 4px 12px; border-radius: 15px; background: #fff; border: 1px solid #ddd; flex-shrink: 0; transition: all 0.2s; font-weight: 500; }
        .lineage-item:hover { border-color: var(--primary-color); color: var(--primary-color); background: #f0f7ff; }
        .lineage-item.current { font-weight: bold; background: var(--primary-color); color: #fff; border-color: var(--primary-color); box-shadow: 0 2px 5px rgba(74, 144, 226, 0.3); }
        .lineage-arrow { color: #bbb; font-size: 12px; flex-shrink: 0; }

        /* --- Form Page --- */
        #form-page { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 5000; flex-direction: column; animation: fadeIn 0.3s ease; }
        .form-header { padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; align-items: center; gap: 15px; background: #fff; flex-shrink: 0; }
        .form-back { font-size: 24px; cursor: pointer; background: none; border: none; padding: 0; color: #333; }
        .form-content { flex: 1; width: 100%; height: 100%; display: flex; flex-direction: column; background: #f0f0f0; }
        .form-iframe { width: 100%; flex: 1; border: none; display: block; background: #fff; }
        .form-fallback { padding: 10px; text-align: center; background: #fff; border-bottom: 1px solid #eee; font-size: 13px; color: #666; }
        .form-fallback a { color: var(--primary-color); text-decoration: none; font-weight: bold; }

        /* --- Print / Save PDF Styles --- */
        @media print {
            /* Hide all UI elements except the report */
            #sidebar, #main, #sidebar-backdrop, 
            #person-modal-overlay, #relationship-modal-overlay, 
            #app-toast,
            header {
                display: none !important;
            }

            /* Reset Body for Print */
            body, html {
                margin: 0;
                padding: 0;
                height: auto;
                overflow: visible;
                background: #fff;
            }

            /* Remove borders from images in print */
            img {
                border: none !important;
                outline: none !important;
            }

            /* Relationship Diagram Print Styles */
            .rel-diagram-container {
                display: flex;
                flex-direction: column;
                align-items: center;
                padding: 20px;
                gap: 5px;
            }
            .rel-node {
                border: 2px solid #4A90E2;
                border-radius: 12px;
                padding: 10px;
                text-align: center;
                min-width: 180px;
                max-width: 220px;
                background: #fff;
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                z-index: 2;
            }
            .rel-arrow {
                display: flex;
                align-items: center;
                justify-content: center;
                position: relative;
                /* Mobile Defaults */
                height: 50px;
                width: 100%;
            }
            /* Connector Line */
            .rel-arrow::after {
                content: '';
                position: absolute;
                background: #ccc;
                z-index: 1;
                /* Mobile: Vertical Line */
                width: 2px;
                height: 100%;
                top: 0;
                left: 50%;
                transform: translateX(-50%);
            }
            .rel-arrow-label {
                position: relative;
                z-index: 3;
                background: #fff;
                padding: 2px 8px;
                color: #E91E63;
                font-weight: bold;
                font-size: 12px;
                border: 1px solid #eee;
                border-radius: 10px;
                white-space: nowrap;
            }

            /* Desktop: Horizontal Layout (Left to Right) */
            @media (min-width: 768px) {
                .rel-diagram-container {
                    flex-direction: row;
                    overflow-x: auto;
                    justify-content: center;
                    padding-bottom: 40px;
                }
                .rel-arrow {
                    height: auto;
                    width: 60px;
                    min-height: 40px;
                }
                /* Desktop: Horizontal Line */
                .rel-arrow::after {
                    width: 100%;
                    height: 2px;
                    top: 50%;
                    left: 0;
                    transform: translateY(-50%);
                }
            }

        }

        /* --- Language Selection Toast --- */
        #language-selection-toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%) translateY(20px); background: #fff; color: #333; padding: 20px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); z-index: 6000; opacity: 0; pointer-events: none; transition: all 0.3s ease; text-align: center; min-width: 300px; border: 1px solid #eee; }
        #language-selection-toast.show { opacity: 1; transform: translateX(-50%) translateY(0); pointer-events: auto; }
        .lang-btn { padding: 10px 20px; margin: 0 5px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 14px; transition: background 0.2s; }
        .lang-btn.te { background: #E91E63; color: white; }
        .lang-btn.kn { background: #FF9800; color: white; }
        .lang-btn.en { background: #607D8B; color: white; }
        .lang-close { position: absolute; top: 5px; right: 10px; background: none; border: none; font-size: 20px; cursor: pointer; color: #999; }

        /* --- Common Ancestor Diagram Styles --- */
        .ca-diagram { display: flex; flex-direction: column; align-items: center; padding: 20px 10px; font-family: 'Segoe UI', sans-serif; overflow-x: auto; }
        
        .ca-node {
            border: 2px solid #4A90E2; border-radius: 12px; padding: 10px; text-align: center;
            width: 140px; background: #fff; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 2; position: relative; display: flex; flex-direction: column; align-items: center;
        }
        .ca-node img { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; margin-bottom: 5px; border: 1px solid #ddd; }
        .ca-node-name { font-weight: bold; font-size: 13px; color: #333; line-height: 1.2; margin-bottom: 2px; }
        .ca-node-id { font-size: 10px; color: #999; }
        .ca-node-role { 
            font-size: 10px; color: #E91E63; font-weight: bold; background: #fff0f5; 
            padding: 2px 8px; border-radius: 10px; margin-bottom: 6px; border: 1px solid #f8bbd0;
            text-transform: uppercase; letter-spacing: 0.5px;
        }

        /* Pivot (Top Node) */
        .ca-pivot-wrapper { display: flex; flex-direction: column; align-items: center; position: relative; margin-bottom: 30px; }
        .ca-pivot-wrapper::after {
            content: ''; position: absolute; top: 100%; left: 50%; width: 2px; height: 30px;
            background: #bbb; transform: translateX(-50%);
        }

        /* Branches Container */
        .ca-branches { display: flex; justify-content: center; gap: 40px; position: relative; }

        /* Branch Column */
        .ca-branch { display: flex; flex-direction: column; align-items: center; position: relative; padding-top: 30px; }

        /* Horizontal Connector (Top of branches) */
        .ca-branch::before { content: ''; position: absolute; top: 0; height: 2px; background: #bbb; }
        
        /* Left Branch: Line from center-right to right edge */
        .ca-branch.left::before { right: -20px; width: calc(50% + 20px); }
        
        /* Right Branch: Line from center-left to left edge */
        .ca-branch.right::before { left: -20px; width: calc(50% + 20px); }

        /* Vertical Connector (From horizontal line down to first node) */
        .ca-branch::after {
            content: ''; position: absolute; top: 0; left: 50%; width: 2px; height: 30px;
            background: #bbb; transform: translateX(-50%);
        }

        /* Node Wrapper in Column */
        .ca-node-wrapper { position: relative; margin-bottom: 30px; }
        .ca-node-wrapper:last-child { margin-bottom: 0; }

        /* Line to next node */
        .ca-node-wrapper::after {
            content: ''; position: absolute; top: 100%; left: 50%; width: 2px; height: 30px;
            background: #bbb; transform: translateX(-50%);
        }
        .ca-node-wrapper:last-child::after { display: none; }

        /* Arrowhead for node connections */
        .ca-node-wrapper::before {
            content: ''; position: absolute; top: calc(100% + 25px); left: 50%; 
            border: 5px solid transparent; border-top-color: #bbb; 
            transform: translateX(-50%); z-index: 1;
        }
        .ca-node-wrapper:last-child::before { display: none; }

        /* Reverse arrows for Left Branch (A -> Pivot) to show flow A -> B */
        .ca-branch.left .ca-node-wrapper::before,
        .ca-single-col.left-stack .ca-node-wrapper::before,
        .ca-sibling-side:first-child .ca-node-wrapper::before {
            border-top-color: transparent; border-bottom-color: #bbb;
            top: calc(100% + 5px); /* Position at top of line, pointing up */
        }

        /* Linear Layout (Single Column) */
        .ca-single-col { padding-top: 0; }
        .ca-single-col::before, .ca-single-col::after { display: none; }

        /* Print Overrides for Diagram */
        @media print {
            .ca-diagram { overflow: visible; width: 100%; }
            .ca-node { border: 1px solid #4A90E2; box-shadow: none; }
            .ca-pivot-wrapper::after, .ca-branch::before, .ca-branch::after, .ca-node-wrapper::after {
                background: #000 !important; -webkit-print-color-adjust: exact;
            }
            .ca-node-wrapper::before { border-top-color: #000 !important; }
            .ca-branch.left .ca-node-wrapper::before,
            .ca-single-col.left-stack .ca-node-wrapper::before,
            .ca-sibling-side:first-child .ca-node-wrapper::before {
                border-top-color: transparent !important; border-bottom-color: #000 !important;
            }
            .ca-node-role { border: 1px solid #ccc; color: #000; }
        }

        /* --- Sibling Bridge Layout --- */
        .ca-sibling-container { display: flex; justify-content: center; gap: 60px; position: relative; margin-top: 10px; }
        
        /* Connector Line between the two sibling columns at the top */
        .ca-sibling-container::before {
            content: ''; position: absolute; top: 45px; left: 50%; transform: translateX(-50%);
            width: 60px; height: 2px; background: #bbb; z-index: 1;
        }

        .ca-sibling-side { display: flex; flex-direction: column; align-items: center; position: relative; }
        
        /* Hide the top connector for the single columns inside sibling layout */
        .ca-sibling-side .ca-single-col { padding-top: 30px; }
        .ca-sibling-side .ca-single-col::before { display: none; }

        /* --- Responsive Mobile Adjustments for Diagram --- */
        @media (max-width: 768px) {
            .ca-node {
                width: 90px;
                padding: 5px;
                min-height: 90px;
            }
            .ca-node img {
                width: 35px;
                height: 35px;
            }
            .ca-node-name {
                font-size: 11px;
                margin-bottom: 0;
            }
            .ca-node-id {
                font-size: 9px;
            }
            .ca-node-role {
                font-size: 9px;
                padding: 2px 4px;
                margin-bottom: 4px;
            }
            .ca-branches {
                gap: 10px;
            }
            .ca-branch.left::before { right: -5px; width: calc(50% + 5px); }
            .ca-branch.right::before { left: -5px; width: calc(50% + 5px); }
            .ca-sibling-container { gap: 20px; }
            .ca-sibling-container::before { width: 20px; }
        }
    </style>
    <link rel="stylesheet" href="./admin-panel.css">
</head>
<body>
    <!-- Sidebar Navigation (hidden in admin-only mode) -->
    <nav id="sidebar">
        <div class="brand">
            <img src="../logo.png" alt="DFWA Logo">
            <h1>VAMSHA VRUKSHA</h1>
            <h2>ADMIN PANEL</h2>
        </div>
        <ul class="menu" id="sidebar-menu">
            <li><a href="#" id="nav-dashboard" class="active" onclick="window.showDashboard(); closeSidebar();">üè† Dashboard</a></li>
            <li><a href="#" id="nav-tree" onclick="window.showTreePage(); closeSidebar();">üå≥ FAMILY TREE</a></li>
            <li><a href="#" id="nav-admin">ADMIN EDITOR</a></li>
            <li><a href="#" onclick="window.toggleLanguage(); closeSidebar();">üåê Language: <span id="lang-display">TEL</span></a></li>
        </ul>
    </nav>

    <!-- Backdrop: tap/click outside sidebar to close it (mobile) -->
    <div id="sidebar-backdrop" aria-hidden="true"></div>

    <!-- Main Content -->
    <div id="main">
        <header>
            <div class="admin-header-left">
                <button id="admin-launch-btn" type="button">Admin Editor</button>
                <span class="admin-header-brand">Admin Mode</span>
            </div>
            <div id="dashboard-header-title" style="display: none; flex: 1; text-align: center;">
                <h2 style="margin: 0; font-size: 23px; color: #E91E63; letter-spacing: 0.5px;">VAMSHA VRUKSHA (ADMIN)</h2>
                <p style="margin: 2px 0 0; font-size: 14px; color: #777; font-weight: 500;">Data Entry Mode</p>
            </div>
            <div class="search-wrapper">
                <!-- Home button is injected here by app.js -->
                <input type="text" id="search-input" placeholder="Search family member...">
                <div id="search-suggestions"></div>
            </div>
        </header>
        <div id="admin-icon-nav">
            <button class="admin-icon-btn active" id="icon-tree" onclick="window.showTreePage();">üå≥ Tree</button>
            <button class="admin-icon-btn" id="icon-dashboard" onclick="window.showDashboard();">üè† Dashboard</button>
            <button class="admin-icon-btn" id="icon-language" onclick="window.toggleLanguage();">üåê Language</button>
            <button class="admin-icon-btn" id="icon-logs">üßæ Logs</button>
        </div>

        <!-- Dashboard Page -->
        <div id="dashboard-page">
            <!-- 1. Namaste Card (Moved to Top) -->
            <div class="namaste-card">
                <h1>ADMIN DASHBOARD üõ†Ô∏è</h1>
            </div>

            <!-- 2.5 Dynamic Message Section -->
            <div id="dash-dynamic-msg" class="dash-message-card"></div>

            <!-- 3. User Identity Section (New Box) -->
            <div id="dash-user-row" class="user-identity-card" style="display:none;">
                <div class="user-identity-content">
                    <div class="user-identity-info">
                        <span class="user-identity-label">Home Person</span>
                        <span id="dash-home-name" class="user-identity-name"></span>
                    </div>
                    <button onclick="window.changeHomePerson()" class="user-change-btn">Change</button>
                </div>
                <!-- Inline Search for Home Person -->
                <div id="dash-search-container" style="display:none; margin-top: 15px; position: relative;">
                    <input type="text" id="dash-search-input" placeholder="Type name (min 3 chars)..." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; outline: none; font-size: 16px;">
                    <div id="dash-search-suggestions" style="position: absolute; top: 100%; left: 0; right: 0; background: #fff; border: 1px solid #ddd; border-radius: 8px; max-height: 200px; overflow-y: auto; z-index: 10; display: none; box-shadow: 0 4px 10px rgba(0,0,0,0.1);"></div>
                </div>
            </div>

            <!-- Open Tree Card -->
            <div class="open-tree-card" onclick="window.showTreePage()">
                <div class="open-tree-bg"></div>
                <div class="open-tree-content">
                    <button class="open-tree-btn">Open Family Tree</button>
                </div>
            </div>

            <!-- Family Info Section -->
            <div class="stats-grid">
                <div class="stat-card" onclick="window.showTreePage()">
                    <div class="stat-icon">üë•</div>
                    <div class="stat-value" id="stat-total-members">-</div>
                    <div class="stat-label">Total Members</div>
                </div>
                <div class="stat-card" onclick="window.focusSearch()">
                    <div class="stat-icon">üîç</div>
                    <div class="stat-value">Find</div>
                    <div class="stat-label">Search Member</div>
                </div>
            </div>
        </div>

        <div id="tree"></div>

        <!-- Lineage Path Bar -->
        <div id="lineage-bar"></div>
    </div>

    <!-- Person Details Modal -->
    <div id="person-modal-overlay" aria-hidden="true">
        <div id="person-modal">
            <div class="modal-header">
                <h3 id="person-modal-name">Name</h3>
                <button id="person-modal-close" class="modal-close">&times;</button>
            </div>
            <div class="modal-scroll-content">
                <div class="avatar-section">
                    <img id="person-modal-avatar" src="" alt="Profile">
                    <div id="person-modal-avatar-fallback"></div>
                    <div id="person-modal-id"></div>
                </div>
                <table class="details-table">
                    <tbody id="person-modal-body">
                        <!-- Rows injected by app.js -->
                    </tbody>
                </table>
                <div id="person-modal-quick-edit" class="person-modal-quick-edit" style="display:none;">
                    <h4 style="margin: 0 0 10px;">Quick Relationship Edit</h4>
                    <div class="person-modal-quick-summary">
                        <div><strong>Parents:</strong> <span id="quick-current-parents">-</span></div>
                        <div><strong>Spouse(s):</strong> <span id="quick-current-spouses">-</span></div>
                        <div><strong>Children:</strong> <span id="quick-current-children">-</span></div>
                    </div>
                    <div class="person-modal-quick-grid">
                        <div>
                            <label for="quick-father-id">Father ID</label>
                            <input id="quick-father-id" list="admin-person-list" placeholder="I0002 or Name">
                        </div>
                        <div>
                            <label for="quick-mother-id">Mother ID</label>
                            <input id="quick-mother-id" list="admin-person-list" placeholder="I0003 or Name">
                        </div>
                    </div>
                    <div class="person-modal-quick-actions">
                        <button id="quick-set-parents" class="btn btn-primary" type="button">Set Parents</button>
                        <button id="quick-clear-father" class="btn btn-outline" type="button">Clear Father</button>
                        <button id="quick-clear-mother" class="btn btn-outline" type="button">Clear Mother</button>
                    </div>
                    <div class="person-modal-quick-grid">
                        <div>
                            <label for="quick-spouse-id">Spouse ID</label>
                            <input id="quick-spouse-id" list="admin-person-list" placeholder="I0010 or Name">
                        </div>
                        <div>
                            <label for="quick-child-id">Child ID</label>
                            <input id="quick-child-id" list="admin-person-list" placeholder="I0101 or Name">
                        </div>
                    </div>
                    <div class="person-modal-quick-grid">
                        <div>
                            <label for="quick-child-role">Child Link Role</label>
                            <select id="quick-child-role">
                                <option value="auto">Auto by selected person's sex</option>
                                <option value="father">Set as Father</option>
                                <option value="mother">Set as Mother</option>
                            </select>
                        </div>
                    </div>
                    <div class="person-modal-quick-actions">
                        <button id="quick-add-spouse" class="btn btn-primary" type="button">Add Spouse</button>
                        <button id="quick-remove-spouse" class="btn btn-outline" type="button">Remove Spouse</button>
                        <button id="quick-add-child" class="btn btn-primary" type="button">Add Child</button>
                        <button id="quick-remove-child" class="btn btn-outline" type="button">Remove Child</button>
                        <button id="quick-undo-last" class="btn btn-outline" type="button">Undo Step</button>
                    </div>
                    <div class="person-modal-quick-actions">
                        <button id="quick-save-draft" class="btn btn-primary" type="button">Save Changes</button>
                        <button id="quick-discard-draft" class="btn btn-outline" type="button">Discard</button>
                        <span id="quick-unsaved-tag" class="quick-unsaved-tag" style="display:none;">Unsaved changes</span>
                    </div>
                    <div id="quick-edit-status" class="person-modal-quick-status">Select a person in tree and edit here.</div>
                    <div class="person-modal-quick-hint">Tip: You can type person ID or full name in these fields.</div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="person-home-btn" class="btn btn-outline">Set as Home</button>
                <button id="relation-btn" class="btn btn-primary">Relationship</button>
                <button id="person-share-btn" class="btn btn-primary">Share Profile</button>
            </div>
        </div>
    </div>

    <!-- Relationship Details Modal -->
    <div id="relationship-modal-overlay" aria-hidden="true" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 3000; justify-content: center; align-items: center; backdrop-filter: blur(2px);">
        <div id="relationship-modal" style="background: #fff; width: 90%; max-width: 400px; border-radius: 12px; box-shadow: 0 15px 35px rgba(0,0,0,0.2); animation: slideUp 0.3s ease;">
            <div class="modal-header">
                <h3 style="margin: 0; font-size: 18px;">Relationship</h3>
                <button id="relationship-modal-close" class="modal-close">&times;</button>
            </div>
            <div id="relationship-modal-body" style="padding: 20px 25px; line-height: 1.6; text-align: center;">
                <!-- Content injected by app.js -->
            </div>
        </div>
    </div>

    <!-- Generic App Toast -->
    <div id="app-toast" class="app-toast"></div>

    <!-- Language Selection Toast -->
    <div id="language-selection-toast">
        <button class="lang-close" onclick="document.getElementById('language-selection-toast').classList.remove('show')">&times;</button>
        <h3 style="margin: 0 0 15px; font-size: 16px;">Select Language / ‡∞≠‡∞æ‡∞∑ / ‡≤≠‡≤æ‡≤∑‡≥Ü</h3>
        <div style="display: flex; justify-content: center; gap: 10px;">
            <button class="lang-btn te" onclick="window.setLanguage('te')">Telugu (‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å)</button>
            <button class="lang-btn kn" onclick="window.setLanguage('kn')">Kannada (‡≤ï‡≤®‡≥ç‡≤®‡≤°)</button>
            <button class="lang-btn en" onclick="window.setLanguage('en')" style="background: #607D8B; color: white;">English Script</button>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="admin-panel-overlay" aria-hidden="true"></div>
    <aside id="admin-panel" aria-hidden="true">
        <div class="admin-panel-header">
            <div class="admin-title-wrap">
                <h3>Admin Editor</h3>
                <p>Edit members and relationships, then export JSON or CSV files.</p>
                <span id="admin-dirty-tag" class="admin-dirty-pill" style="display:none;">Unsaved draft changes</span>
            </div>
            <button id="admin-close-panel" class="admin-close-btn" type="button">Close</button>
        </div>
        <div class="admin-panel-content">
            <section class="admin-section">
                <h4>Pick Person</h4>
                <div class="admin-inline">
                    <div class="admin-field">
                        <label for="admin-person-pick">Person ID</label>
                        <input id="admin-person-pick" list="admin-person-list" placeholder="I0001">
                        <datalist id="admin-person-list"></datalist>
                    </div>
                    <button id="admin-load-person" class="admin-btn secondary" type="button">Load</button>
                </div>
                <div class="admin-actions-row">
                    <button id="admin-open-modal-person" class="admin-btn muted" type="button">Load Modal Person</button>
                    <button id="admin-add-person" class="admin-btn primary" type="button">Add New Person</button>
                    <button id="admin-delete-person" class="admin-btn danger" type="button">Delete Person</button>
                </div>
            </section>

            <section class="admin-section">
                <h4>Person Details</h4>
                <div class="admin-grid">
                    <div class="admin-field">
                        <label for="admin-person-id">Person ID</label>
                        <input id="admin-person-id" readonly>
                    </div>
                    <div class="admin-field">
                        <label for="admin-sex">Sex</label>
                        <select id="admin-sex">
                            <option value="M">Male</option>
                            <option value="F">Female</option>
                        </select>
                    </div>
                    <div class="admin-field">
                        <label for="admin-given-name">Given Name</label>
                        <input id="admin-given-name">
                    </div>
                    <div class="admin-field">
                        <label for="admin-surname">Surname</label>
                        <input id="admin-surname">
                    </div>
                    <div class="admin-field">
                        <label for="admin-birth-date">Birth Date (dd-MMM-yyyy)</label>
                        <input id="admin-birth-date" placeholder="12-Jan-1985">
                    </div>
                    <div class="admin-field">
                        <label>Birth Date Type</label>
                        <div class="admin-radio-inline">
                            <label class="admin-check-inline">
                                <input id="admin-birth-date-type-exact" name="admin-birth-date-type" type="radio" value="exact" checked>
                                <span>Exact</span>
                            </label>
                            <label class="admin-check-inline">
                                <input id="admin-birth-date-type-approximate" name="admin-birth-date-type" type="radio" value="approximate">
                                <span>Approximate</span>
                            </label>
                        </div>
                    </div>
                    <div class="admin-field">
                        <label for="admin-birth-place-id">Birth Place ID</label>
                        <input id="admin-birth-place-id" placeholder="P0001">
                    </div>
                    <div class="admin-field">
                        <label for="admin-birth-place-name">Birth Place Name</label>
                        <input id="admin-birth-place-name" placeholder="Place name">
                    </div>
                    <div class="admin-field admin-field-check">
                        <label for="admin-is-deceased">Status</label>
                        <label class="admin-check-inline">
                            <input id="admin-is-deceased" type="checkbox">
                            <span>Deceased</span>
                        </label>
                    </div>
                    <div class="admin-field" id="admin-death-date-wrap" style="display:none;">
                        <label for="admin-death-date">Death Date (dd-MMM-yyyy)</label>
                        <input id="admin-death-date" placeholder="07-Aug-2021">
                    </div>
                    <div class="admin-field">
                        <label for="admin-phone">Phone</label>
                        <input id="admin-phone">
                    </div>
                    <div class="admin-field">
                        <label for="admin-email">Email</label>
                        <input id="admin-email">
                    </div>
                </div>
                <div class="admin-grid-single" style="margin-top:10px;">
                    <div class="admin-field">
                        <label for="admin-note">Note</label>
                        <textarea id="admin-note"></textarea>
                    </div>
                </div>
            </section>

            <section class="admin-section">
                <details id="admin-custom-details">
                    <summary class="admin-collapsible-summary">Custom Fields</summary>
                    <div id="admin-custom-fields-list" class="admin-custom-list"></div>
                    <div class="admin-grid" style="margin-top:10px;">
                        <div class="admin-field">
                            <label for="admin-custom-key">Key</label>
                            <input id="admin-custom-key" placeholder="eg: gothram">
                        </div>
                        <div class="admin-field">
                            <label for="admin-custom-value">Value</label>
                            <input id="admin-custom-value" placeholder="eg: Bharadwaja">
                        </div>
                    </div>
                    <div class="admin-actions-row">
                        <button id="admin-custom-add" class="admin-btn secondary" type="button">Add/Update Field</button>
                        <button id="admin-custom-clear" class="admin-btn warn" type="button">Clear Inputs</button>
                    </div>
                    <div class="admin-note">Stored as <code>custom: {}</code> in persons.json for future extensibility.</div>
                </details>
            </section>

            <section class="admin-section">
                <details id="admin-jyotisha-details">
                    <summary class="admin-collapsible-summary">Jyotisha</summary>
                    <div class="admin-grid" style="margin-top:10px;">
                        <div class="admin-field">
                            <label for="admin-jyotisha-gothra">Gothra</label>
                            <select id="admin-jyotisha-gothra">
                                <option value="">Select Gothra</option>
                                <option value="Atri">Atri</option>
                                <option value="Bharadwaja">Bharadwaja</option>
                                <option value="Bhrigu">Bhrigu</option>
                                <option value="Gautama">Gautama</option>
                                <option value="Harita">Harita</option>
                                <option value="Jamadagni">Jamadagni</option>
                                <option value="Kashyapa">Kashyapa</option>
                                <option value="Kaundinya">Kaundinya</option>
                                <option value="Vasishta">Vasishta</option>
                                <option value="Vishwamitra">Vishwamitra</option>
                            </select>
                        </div>
                        <div class="admin-field">
                            <label for="admin-jyotisha-nakshatra">Nakshatra</label>
                            <select id="admin-jyotisha-nakshatra">
                                <option value="">Select Nakshatra</option>
                                <option value="Ashwini">Ashwini</option>
                                <option value="Bharani">Bharani</option>
                                <option value="Krittika">Krittika</option>
                                <option value="Rohini">Rohini</option>
                                <option value="Mrigashira">Mrigashira</option>
                                <option value="Ardra">Ardra</option>
                                <option value="Punarvasu">Punarvasu</option>
                                <option value="Pushya">Pushya</option>
                                <option value="Ashlesha">Ashlesha</option>
                                <option value="Magha">Magha</option>
                                <option value="Purva Phalguni">Purva Phalguni</option>
                                <option value="Uttara Phalguni">Uttara Phalguni</option>
                                <option value="Hasta">Hasta</option>
                                <option value="Chitra">Chitra</option>
                                <option value="Swati">Swati</option>
                                <option value="Vishakha">Vishakha</option>
                                <option value="Anuradha">Anuradha</option>
                                <option value="Jyeshtha">Jyeshtha</option>
                                <option value="Mula">Mula</option>
                                <option value="Purva Ashadha">Purva Ashadha</option>
                                <option value="Uttara Ashadha">Uttara Ashadha</option>
                                <option value="Shravana">Shravana</option>
                                <option value="Dhanishta">Dhanishta</option>
                                <option value="Shatabhisha">Shatabhisha</option>
                                <option value="Purva Bhadrapada">Purva Bhadrapada</option>
                                <option value="Uttara Bhadrapada">Uttara Bhadrapada</option>
                                <option value="Revati">Revati</option>
                            </select>
                        </div>
                        <div class="admin-field">
                            <label for="admin-jyotisha-rashi">Rashi</label>
                            <select id="admin-jyotisha-rashi">
                                <option value="">Select Rashi</option>
                                <option value="Mesha">Mesha</option>
                                <option value="Vrishabha">Vrishabha</option>
                                <option value="Mithuna">Mithuna</option>
                                <option value="Karka">Karka</option>
                                <option value="Simha">Simha</option>
                                <option value="Kanya">Kanya</option>
                                <option value="Tula">Tula</option>
                                <option value="Vrischika">Vrischika</option>
                                <option value="Dhanu">Dhanu</option>
                                <option value="Makara">Makara</option>
                                <option value="Kumbha">Kumbha</option>
                                <option value="Meena">Meena</option>
                            </select>
                        </div>
                    </div>
                    <div class="admin-note">Stored as <code>jyotisha: { gothra, nakshatra, rashi }</code> in persons.json.</div>
                </details>
            </section>

            <section class="admin-section">
                <details id="admin-photo-details">
                    <summary class="admin-collapsible-summary">Photo</summary>
                    <div class="admin-photo-wrap" style="margin-top:10px;">
                        <img id="admin-photo-preview" class="admin-photo-preview" alt="Photo preview">
                        <div class="admin-photo-meta">
                            <div><strong>Current Path:</strong> <span id="admin-photo-path">-</span></div>
                            <div class="admin-note">Expected format: <code>icons/Ixxxx.jpg</code> (or png/webp/jpeg).</div>
                        </div>
                    </div>
                    <div class="admin-grid-single" style="margin-top:10px;">
                        <div class="admin-field">
                            <label for="admin-photo-file">Select New Photo</label>
                            <input id="admin-photo-file" type="file" accept="image/*">
                        </div>
                    </div>
                    <div class="admin-actions-row">
                        <button id="admin-photo-apply" class="admin-btn secondary" type="button">Apply Photo Mapping</button>
                        <button id="admin-photo-download" class="admin-btn muted" type="button">Download Renamed Image</button>
                        <button id="admin-photo-remove" class="admin-btn warn" type="button">Remove Photo</button>
                    </div>
                </details>
            </section>

            <section class="admin-section">
                <h4>Parents</h4>
                <div id="admin-parent-display" class="admin-parent-display">
                    <div class="admin-parent-row">
                        <span><strong>Father:</strong> <span id="admin-parent-father-name">-</span></span>
                        <button id="admin-parent-father-remove" type="button" class="admin-parent-remove" title="Remove father">x</button>
                    </div>
                    <div class="admin-parent-row">
                        <span><strong>Mother:</strong> <span id="admin-parent-mother-name">-</span></span>
                        <button id="admin-parent-mother-remove" type="button" class="admin-parent-remove" title="Remove mother">x</button>
                    </div>
                </div>
                <div class="admin-grid">
                    <div class="admin-field">
                        <label for="admin-father-id">Father ID</label>
                        <input id="admin-father-id" list="admin-person-list" placeholder="I0002">
                    </div>
                    <div class="admin-field">
                        <label for="admin-mother-id">Mother ID</label>
                        <input id="admin-mother-id" list="admin-person-list" placeholder="I0003">
                    </div>
                </div>
                <div class="admin-actions-row">
                    <button id="admin-clear-father" class="admin-btn warn" type="button">Clear Father</button>
                    <button id="admin-clear-mother" class="admin-btn warn" type="button">Clear Mother</button>
                </div>
            </section>

            <section class="admin-section">
                <h4>Spouse</h4>
                <div id="admin-spouse-chip-list" class="admin-chip-list"></div>
                <div class="admin-inline" style="margin-top:10px;">
                    <div class="admin-field">
                        <label for="admin-spouse-id">Add Spouse ID</label>
                        <input id="admin-spouse-id" list="admin-person-list" placeholder="I0010">
                    </div>
                    <button id="admin-add-spouse" class="admin-btn secondary" type="button">Add Spouse</button>
                </div>
                <div class="admin-grid" style="margin-top:10px;">
                    <div class="admin-field">
                        <label for="admin-divorce-spouse-id">Divorce Spouse ID</label>
                        <input id="admin-divorce-spouse-id" list="admin-person-list" placeholder="I0010">
                    </div>
                    <div class="admin-field">
                        <label for="admin-divorce-date">Divorce Date (dd-MMM-yyyy, optional)</label>
                        <input id="admin-divorce-date" placeholder="07-Aug-2021">
                    </div>
                </div>
                <div class="admin-actions-row">
                    <button id="admin-record-divorce" class="admin-btn warn" type="button">Record Divorce</button>
                </div>
                <div id="admin-divorce-history-list" class="admin-chip-list"></div>
            </section>

            <section class="admin-section">
                <h4>Children</h4>
                <div id="admin-children-chip-list" class="admin-chip-list"></div>
                <div class="admin-grid" style="margin-top:10px;">
                    <div class="admin-field">
                        <label for="admin-children-input">Child IDs (comma/space/newline separated)</label>
                        <textarea id="admin-children-input" placeholder="I0101, I0102"></textarea>
                    </div>
                    <div class="admin-field">
                        <label for="admin-coparent-id">Co-parent ID (optional)</label>
                        <input id="admin-coparent-id" list="admin-person-list" placeholder="I0050">
                        <label for="admin-selected-role" style="margin-top:8px;">Selected person is</label>
                        <select id="admin-selected-role">
                            <option value="father">Father</option>
                            <option value="mother">Mother</option>
                        </select>
                    </div>
                </div>
                <div class="admin-actions-row">
                    <button id="admin-add-children" class="admin-btn secondary" type="button">Add/Update Children</button>
                </div>
                <div class="admin-note">Use this to add multiple children at once and remove child links using x buttons above.</div>
            </section>

            <section class="admin-section">
                <details id="admin-validation-details">
                    <summary class="admin-collapsible-summary">Validation</summary>
                    <div class="admin-actions-row">
                        <button id="admin-run-validation" class="admin-btn secondary" type="button">Run Validation</button>
                    </div>
                    <div id="admin-validation-summary" class="admin-note" style="margin-top:10px;">Run validation before export.</div>
                    <div id="admin-validation-list" class="admin-validation-list"></div>
                </details>
            </section>

            <section class="admin-section">
                <details id="admin-apply-details" open>
                    <summary class="admin-collapsible-summary">Apply</summary>
                    <div class="admin-actions-row" style="margin-top:10px;">
                        <button id="admin-save-person" class="admin-btn primary" type="button">Save Person</button>
                        <button id="admin-refresh-tree" class="admin-btn secondary" type="button">Refresh Tree Now</button>
                        <button id="admin-discard-changes" class="admin-btn warn" type="button">Discard Changes</button>
                    </div>
                    <div id="admin-status-line"></div>
                </details>
            </section>

            <section class="admin-section">
                <details id="admin-export-json-details">
                    <summary class="admin-collapsible-summary">Export JSON</summary>
                    <div class="admin-actions-row" style="margin-top:10px;">
                        <button id="admin-export-persons" class="admin-btn muted" type="button">Download persons.json</button>
                        <button id="admin-export-families" class="admin-btn muted" type="button">Download families.json</button>
                        <button id="admin-export-contacts" class="admin-btn muted" type="button">Download contacts.json</button>
                        <button id="admin-export-photos" class="admin-btn muted" type="button">Download photos.json</button>
                        <button id="admin-export-schema" class="admin-btn muted" type="button">Download schema.json</button>
                        <button id="admin-export-all" class="admin-btn warn" type="button">Download All JSON</button>
                    </div>
                </details>
            </section>

            <section class="admin-section">
                <details id="admin-export-csv-details">
                    <summary class="admin-collapsible-summary">Export CSV</summary>
                    <div class="admin-actions-row" style="margin-top:10px;">
                        <button id="admin-export-persons-csv" class="admin-btn muted" type="button">Download persons.csv</button>
                        <button id="admin-export-families-csv" class="admin-btn muted" type="button">Download families.csv</button>
                        <button id="admin-export-contacts-csv" class="admin-btn muted" type="button">Download contacts.csv</button>
                        <button id="admin-export-photos-csv" class="admin-btn muted" type="button">Download photos.csv</button>
                        <button id="admin-export-all-csv" class="admin-btn warn" type="button">Download All CSV</button>
                    </div>
                </details>
            </section>

            <section class="admin-section">
                <details id="admin-import-details">
                    <summary class="admin-collapsible-summary">Import + Merge</summary>
                    <div class="admin-grid-single" style="margin-top:10px;">
                        <div class="admin-field">
                            <label for="admin-import-file">Upload JSON/CSV File</label>
                            <input id="admin-import-file" type="file" accept=".json,.csv,application/json,text/csv">
                        </div>
                    </div>
                    <div class="admin-grid" style="margin-top:10px;">
                        <div class="admin-field">
                            <label for="admin-import-mode">Conflict Strategy</label>
                            <select id="admin-import-mode">
                                <option value="merge">Merge (Recommended)</option>
                                <option value="replace">Replace Existing</option>
                                <option value="skip">Skip Existing</option>
                            </select>
                        </div>
                        <div class="admin-field">
                            <label for="admin-import-target">Detected Type</label>
                            <input id="admin-import-target" readonly placeholder="Auto detect">
                        </div>
                    </div>
                    <div class="admin-actions-row">
                        <button id="admin-import-preview" class="admin-btn secondary" type="button">Preview Import</button>
                        <button id="admin-import-apply" class="admin-btn primary" type="button">Apply Import</button>
                        <button id="admin-import-clear" class="admin-btn warn" type="button">Clear Import</button>
                    </div>
                    <div id="admin-import-summary" class="admin-note" style="margin-top:10px;">Upload a JSON or CSV file, preview impact, then apply.</div>
                    <pre id="admin-import-preview-box" class="admin-import-preview-box"></pre>
                </details>
            </section>

            <section class="admin-section" id="admin-logs-section">
                <h4>Action Logs</h4>
                <div class="admin-actions-row">
                    <button id="admin-refresh-logs" class="admin-btn secondary" type="button">Refresh Logs</button>
                    <button id="admin-export-logs-csv" class="admin-btn muted" type="button">Export Logs (CSV)</button>
                    <button id="admin-clear-logs" class="admin-btn muted" type="button">Clear Logs</button>
                </div>
                <div id="admin-log-summary" class="admin-note" style="margin-top:10px;">No actions yet.</div>
                <div id="admin-log-list" class="admin-log-list"></div>
            </section>
        </div>
    </aside>
    <!-- Scripts -->
    <script src="https://balkan.app/js/FamilyTree.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <script src="../relationship.js"></script>
    <script src="../app.js"></script>
    <script src="./admin-panel.js"></script>
    <script>
        // Sidebar toggle and close (expose closeSidebar for menu onclick)
        function toggleSidebar() {
            var sidebar = document.getElementById('sidebar');
            var backdrop = document.getElementById('sidebar-backdrop');
            if (!sidebar) return;
            sidebar.classList.toggle('open');
            if (backdrop) backdrop.classList.toggle('show', sidebar.classList.contains('open'));
        }
        function closeSidebar() {
            var sidebar = document.getElementById('sidebar');
            var backdrop = document.getElementById('sidebar-backdrop');
            if (sidebar) sidebar.classList.remove('open');
            if (backdrop) backdrop.classList.remove('show');
        }
        // Click/tap on backdrop closes sidebar (mobile overlay)
        (function() {
            var backdrop = document.getElementById('sidebar-backdrop');
            if (backdrop) backdrop.addEventListener('click', closeSidebar);
        })();
    </script>

</body>
</html>





